Backport of:

From 6256729a6da532079505edfe4c56a6ef29cd8ab8 Mon Sep 17 00:00:00 2001
From: Allan Sandfeld Jensen <allan.jensen@qt.io>
Date: Mon, 13 Aug 2018 15:29:16 +0200
Subject: [PATCH] Fix possible heap corruption in QXmlStream

The value of 'tos' at the check might already be on the last element,
so triggering stack expansion on the second last element is too late.

Change-Id: Ib3ab2662d4d27a71effe9e988b9e172923af2908
Reviewed-by: Richard J. Moore <rich@kde.org>
Reviewed-by: Thiago Macieira <thiago.macieira@intel.com>
---
 src/corelib/serialization/qxmlstream_p.h | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: qtbase-opensource-src-5.9.5+dfsg/src/corelib/xml/qxmlstream_p.h
===================================================================
--- qtbase-opensource-src-5.9.5+dfsg.orig/src/corelib/xml/qxmlstream_p.h	2019-02-05 13:11:27.085486521 -0500
+++ qtbase-opensource-src-5.9.5+dfsg/src/corelib/xml/qxmlstream_p.h	2019-02-05 13:11:27.077486473 -0500
@@ -1243,7 +1243,7 @@ bool QXmlStreamReaderPrivate::parse()
             state_stack[tos] = 0;
             return true;
         } else if (act > 0) {
-            if (++tos == stack_size-1)
+            if (++tos >= stack_size-1)
                 reallocateStack();
 
             Value &val = sym_stack[tos];
